@using KenticoKontentModels
@model Page
@{
    Layout = null;
    bool pageHasSubpages = Model.Subpages.Count() > 0 ? true : false;
    bool pageHasContent = Model.Content.Count() > 0 ? true : false;
    bool pageIsCategoryOnly = Model.CategoryOnly.First().Codename == "yes" ? true : false;
    bool pageIsRedirect = Model.RedirectionUrls.Count() > 0 ? true : false;
    var pageUrl = Model.Url != null ? Model.Url : "#";
}

@* Menu item is a dummy item with sub-items *@
@if (pageIsCategoryOnly && pageHasSubpages)
{
    <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">@Model.Title</a>
        <ul class="dropdown-menu">
            @foreach (Page page in Model.Subpages)
            {
                if (page.ShowInNavigation.FirstOrDefault().Codename == "yes")
                {
                    @Html.DisplayFor(vm => page, "NavigationDisplay")
                }
            }
        </ul>
    </li>
}
else
{
    <li>
        @if (pageIsRedirect)
        {
            RedirectionUrl redirecton = Model.RedirectionUrls.First();
            if (redirecton.RedirectTo.Length > 0)
            {
                <a href=@redirecton.RedirectTo target="_blank">@Model.Title</a>
            }
            else
            {
                <localized-route asp-controller=@redirecton.RedirectToInternal.First().PageCodename asp-action="Index">@Model.Title</localized-route>
            }

        }
        else
        {

            @if (pageHasContent && !pageIsCategoryOnly)
            {
                <localized-route asp-controller=@Model.PageCodename asp-action="Index">@Model.Title</localized-route>

                @* Check for nested navigation items *@
                <ul>
                    @foreach (Page page in Model.Subpages)
                    {
                        if (page.ShowInNavigation.FirstOrDefault().Codename == "yes")
                        {
                            @Html.DisplayFor(vm => page, "NavigationDisplay")
                        }
                    }
                </ul>
            }
            else
            {
                <localized-route asp-controller="Errors" asp-action="NotFound">@Model.Title</localized-route>
            }

        }
    </li>
}